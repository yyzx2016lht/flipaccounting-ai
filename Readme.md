# FlipAccounting-AI (翻转记账 AI 版)

FlipAccounting-AI 是一款创新的 Android 记账应用，旨在通过直观的“翻转”手势和强大的 AI 辅助，让记账变得更高效。它利用手机传感器检测翻转动作，结合 AI 智能识别消费资产与分类，配合 Shizuku 赋予的高级权限可以尽可能减少误触的情况。

**特此声明：**该应用仅适配钱迹，软件设计初衷是为了方便作者在缺少root权限的情况下可以通过便捷的方式打开悬浮窗进行记账。所有代码均由ai生成，所以遇到改进的想法可以提，有bug也可以提，但是能否解决取决于ai的实力hh。

**补充说明：**软件需要常驻后台，用户需设置自启动，电池不限制以及锁定后台才能取得最佳体验。

## ✨ 核心功能

*   **🔄 翻转触发 (Flip Detection)**
    *   利用加速度传感器和陀螺仪检测手机翻转动作，作为快速启动记账或触发特定自动化流程的快捷方式。
    *   支持后台运行监测，无需打开应用即可响应。
    *   有白名单模式，开启后只在指定应用中响应。（需要shizuku支持）
    *   支持调节灵敏度，根据自身习惯来调整翻转手势的触发条件（可拖进度条也可输入文本）

*   **🤖 AI 智能助手 (AI Assistant)**
    *   可以利用 AI 模型分析消费数据，建议使用硅基流动，使用免费的qwen2.5-7b模型即可。
    *   智能分类：根据输入的金额或描述，自动推荐最匹配的消费分类。
    *   自然语言记账：支持通过语音输入，让 AI 自动解析金额、类别和备注。默认采用的是硅基流动的 TeleAI 模型，同样免费试用，可以识别方言。文本输入则调用 AI 配置页面的 AI 模型。
    *   AI智能助手包括语音输入与文本输入，可关闭

*   **📈 多币种支持 (Multi-Currency)**
    *   可以自定义添加额外货币
    *   **此多币种与钱迹的不同** 这里的多币种仅为将其他货币转化为人民币金额再传入钱迹，钱迹中只会显示转化后的人民币金额，不会显示其余币种的符号
    *   可以自定义刷新汇率的时间

*   **📱 悬浮窗交互 (Overlay Interface)**
    *   提供全局悬浮窗界面，在任何界面下都能快速呼出记账面板，不打断当前操作流（例如在微信/支付宝支付完成后直接记账）。记账中途想打断只需要点击悬浮窗外的部分即可取消。

*   **📊 资产与分类管理**
    *   支持多资产账户管理（现金、银行卡、虚拟账户等）。（与钱迹匹配）
    *   自定义收支分类，支持层级管理。

*   **🧾 账单管理 (Bills)**
    *   查看历史账单：可以在应用内浏览所有通过本软件生成并保存的账单，支持按时间、账户、分类、金额和关键词搜索与筛选，便于查找与复核。
    *   账单详情：每条账单展示原始金额、币种、所属账户、分类、备注、时间戳以及用于折算的汇率快照（如适用），并保留导入/导出状态记录。
    *   批量导入到钱迹：支持选择多条账单并一键批量导入到钱迹（通过构造 qianji://publicapi/addbill?... 的批量调用或生成供钱迹导入的文件/Intent 列表）。导入前会显示预览与冲突检测（例如重复导入提示）。

*   **📝 日志与调试**
    *   内置日志查看器，方便开发者或高级用户排查问题。

*   **💾 备份与恢复 (Backup & Restore)**
    *   提供一键备份与恢复功能，支持本地文件导出/导入以及通过备份文件恢复应用状态。
    *   备份项包括：
        *   应用设置与偏好（`Prefs`）
        *   资产账户与默认币种配置
        *   分类与图标映射（包括自定义分类）
        *   账单记录（本项目生成的账单数据）
        *   汇率缓存与手动汇率覆盖记录
        *   批量导入/导出映射与操作日志（便于回滚）
        *   AI 配置与辅助输入记录（不包含敏感 AI 密钥）
    *   备份文件格式为易于传输的 JSON（或 ZIP 包含资源），并在恢复前显示预览与冲突提示。

## 🛠️ 技术栈

本项目基于现代 Android 技术栈构建：

*   **语言**: Kotlin (主要), Java (部分工具类)
*   **构建工具**: Gradle (Kotlin DSL)
*   **架构**: MVVM (Activity + ViewModel + Repository 模式)
*   **核心库**:
    *   **Android Jetpack**: Core KTX, Appcompat, Lifecycle, ViewModel
    *   **UI**: Material Design 3, XML Layouts
    *   **网络**: Retrofit + OkHttp (用于 AI 接口通信)
    *   **系统交互**: WindowManager (悬浮窗), SensorManager (传感器)
    *   **特权操作**: [Shizuku API](https://shizuku.rikka.app/)
    *   **图片加载**: Glide
    *   **JSON 解析**: Gson

## 📦 依赖环境

*   **Android SDK**: Compile SDK 34 / Target SDK 34
*   **Min SDK**: 24 (Android 7.0+)
*   **JDK**: Java 17

## 🚀 快速开始

1.  **环境配置**
    *   确保安装了 Android Studio Ladybug 或更新版本。
    *   JDK 17 或更高版本。
    *   配置好 `local.properties` 中的 SDK 路径。

2.  **编译运行**
    *   连接 Android 设备或启动模拟器。
    *   运行 `app` 模块。

3.  **初次设置**
    *   **授予权限**：
        *   **悬浮窗权限**：必须授予，否则无法显示记账面板。
        *   **主要服务权限**：确保应用可以在后台运行，建议加入电池优化白名单。
        *   **麦克风权限**（可选）：不使用语音功能无需麦克风权限。
        *   **Shizuku 授权**（可选）：Shizuku是为了获取前台使用应用，不使用白名单的情况下无需Shizuku支持。

## 🔒 权限说明

为了实现核心功能，应用需要请求以下敏感权限：

*   `SYSTEM_ALERT_WINDOW`: 用于在其他应用上层显示悬浮窗记账界面。
*   `FOREGROUND_SERVICE`: 保证翻转检测服务在后台持续运行，不被系统查杀。
*   `RECORD_AUDIO`: 用于语音记账功能（如果开启）。
*   `QUERY_ALL_PACKAGES`: 用于检测支付应用运行状态（需 Shizuku 配合）。

## 🤝 贡献

欢迎提交 Issue 或 Pull Request！如果您有更好的 AI 模型集成思路或对翻转算法有改进建议，请不吝赐教。

## 🙏 致谢

特别感谢 [AutoAccounting](https://github.com/AutoAccountingOrg/AutoAccounting) 项目：

*   本项目的核心 **翻转检测机制 (Flip Detection)** 参考了该项目的开源实现。
*   许多业务逻辑处理和自动化流程的设计灵感，均源于作者长期使用 AutoAccounting 的体验与思考。

感谢 AutoAccounting 团队为开源社区做出的贡献！

## 🤖 AI 辅助声明

本项目是 **面向 AI 编程 (AI-Oriented Programming)** 的实践产物。核心代码与逻辑实现深度依赖于现代 AI 编程助手：

*   **GitHub Copilot**
*   **Google Gemini**

特别感谢 **GitHub** 和 **Google** 对学生开发者的慷慨支持，让创意能够更轻松地转化为现实。

---
*Generated with ❤️ by GitHub Copilot*
